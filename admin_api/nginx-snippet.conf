location = /admin/restart-app {
    limit_except POST { deny all; }
    proxy_pass http://127.0.0.1:5001/admin/restart-app;
    proxy_set_header X-Real-IP $remote_addr;
}

location = /admin/reload-nginx {
    limit_except POST { deny all; }
    proxy_pass http://127.0.0.1:5001/admin/reload-nginx;
    proxy_set_header X-Real-IP $remote_addr;
}

location = /admin/reboot {
    limit_except POST { deny all; }
    proxy_pass http://127.0.0.1:5001/admin/reboot;
    proxy_set_header X-Real-IP $remote_addr;
}

# Branch list (GET)
location = /admin/branches {
    limit_except GET { deny all; }
    proxy_pass http://127.0.0.1:5001/admin/branches;
    proxy_set_header X-Real-IP $remote_addr;
}

# Pull & Build (fire-and-forget; GET/POST)
location = /admin/pull-code {
    proxy_pass http://127.0.0.1:5001/admin/pull-code;
    proxy_set_header X-Real-IP $remote_addr;
}

# Pull & Build streaming logs (SSE)
location = /admin/pull-code/stream {
    limit_except GET { deny all; }
    proxy_pass http://127.0.0.1:5001/admin/pull-code/stream;
    proxy_http_version 1.1;
    proxy_set_header Connection "";
    proxy_set_header X-Real-IP $remote_addr;
    proxy_buffering off;
    proxy_read_timeout 1h;
}
