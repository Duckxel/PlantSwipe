# Admin API health check - fast response for monitoring
location = /admin/health {
    proxy_pass http://127.0.0.1:5001/health;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_connect_timeout 2s;
    proxy_read_timeout 5s;
}

location = /admin/restart-app {
    limit_except POST { deny all; }
    proxy_pass http://127.0.0.1:5001/admin/restart-app;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_connect_timeout 5s;
    proxy_read_timeout 30s;
}

location = /admin/reload-nginx {
    limit_except POST { deny all; }
    proxy_pass http://127.0.0.1:5001/admin/reload-nginx;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_connect_timeout 5s;
    proxy_read_timeout 30s;
}

location = /admin/reboot {
    limit_except POST { deny all; }
    proxy_pass http://127.0.0.1:5001/admin/reboot;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_connect_timeout 5s;
    proxy_read_timeout 30s;
}

# Branch list (GET) - needs time for git operations
location = /admin/branches {
    limit_except GET { deny all; }
    proxy_pass http://127.0.0.1:5001/admin/branches;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_connect_timeout 5s;
    proxy_read_timeout 60s;
}

# Schema sync - can take time for DB operations
location = /admin/sync-schema {
    proxy_pass http://127.0.0.1:5001/admin/sync-schema;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_connect_timeout 5s;
    proxy_read_timeout 180s;
}

# Deploy edge functions - can take several minutes
location = /admin/deploy-edge-functions {
    proxy_pass http://127.0.0.1:5001/admin/deploy-edge-functions;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_connect_timeout 5s;
    proxy_read_timeout 900s;
}

# Pull & Build (fire-and-forget; GET/POST)
location = /admin/pull-code {
    proxy_pass http://127.0.0.1:5001/admin/pull-code;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_connect_timeout 5s;
    proxy_read_timeout 30s;
}

# Pull & Build streaming logs (SSE)
location = /admin/pull-code/stream {
    limit_except GET { deny all; }
    proxy_pass http://127.0.0.1:5001/admin/pull-code/stream;
    proxy_http_version 1.1;
    proxy_set_header Connection "";
    proxy_set_header X-Real-IP $remote_addr;
    proxy_buffering off;
    proxy_connect_timeout 5s;
    proxy_read_timeout 1h;
}
