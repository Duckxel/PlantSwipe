<!doctype html>
<html lang="en">
    <head>
      <meta charset="UTF-8" />
      <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
      <meta name="application-name" content="Aphylia" />
      <meta name="description" content="Discover, swipe and manage the perfect plants for every garden." />
      <meta name="theme-color" content="#052e16" />
      
      <!-- Canonical URL (updated dynamically by React) -->
      <link rel="canonical" href="https://aphylia.app" />
      
      <!-- Open Graph / Facebook / Discord / Telegram / LinkedIn -->
      <meta property="og:type" content="website" />
      <meta property="og:site_name" content="Aphylia" />
      <meta property="og:url" content="https://aphylia.app" />
      <meta property="og:title" content="Aphylia - Discover & Grow Your Perfect Garden" />
      <meta property="og:description" content="Discover, swipe and manage the perfect plants for every garden. Track growth, get care reminders, and build your dream garden." />
      <meta property="og:image" content="https://media.aphylia.app/UTILITY/admin/uploads/png/baniere-logo-plus-titre-v2-54ef1ba8-2e4d-47fd-91bb-8bf4cbe01260-ae7e1e2d-ea1d-4944-be95-84cc4b8a29ed.png" />
      <meta property="og:image:alt" content="Aphylia - Your Personal Plant Companion" />
      <meta property="og:locale" content="en_US" />
      
      <!-- Twitter Card -->
      <meta name="twitter:card" content="summary_large_image" />
      <meta name="twitter:url" content="https://aphylia.app" />
      <meta name="twitter:title" content="Aphylia - Discover & Grow Your Perfect Garden" />
      <meta name="twitter:description" content="Discover, swipe and manage the perfect plants for every garden. Track growth, get care reminders, and build your dream garden." />
      <meta name="twitter:image" content="https://media.aphylia.app/UTILITY/admin/uploads/png/baniere-logo-plus-titre-v2-54ef1ba8-2e4d-47fd-91bb-8bf4cbe01260-ae7e1e2d-ea1d-4944-be95-84cc4b8a29ed.png" />
      <meta name="twitter:image:alt" content="Aphylia - Your Personal Plant Companion" />
      <meta name="apple-mobile-web-app-capable" content="yes" />
      <meta name="mobile-web-app-capable" content="yes" />
      <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
      <!-- 
        GDPR-Compliant Google Analytics & reCAPTCHA Loading
        - Google Analytics: Only loads after user gives analytics consent
        - reCAPTCHA: Loads after any consent (essential for security)
        See src/lib/gdprScripts.ts for the consent-aware loader
      -->
      <script>
        // GDPR-Compliant Analytics Loader
        // Analytics will only be initialized after user consent
        window.dataLayer = window.dataLayer || [];
        window.gtag = function(){dataLayer.push(arguments);};
        
        // Function to load Google Analytics after consent
        window.__loadGoogleAnalytics = function() {
          if (window.__gaLoaded) return;
          window.__gaLoaded = true;
          
          var script = document.createElement('script');
          script.async = true;
          script.src = 'https://www.googletagmanager.com/gtag/js?id=G-LDSYW5QNK5';
          document.head.appendChild(script);
          
          script.onload = function() {
            gtag('js', new Date());
            // Configure with anonymize_ip for additional privacy
            gtag('config', 'G-LDSYW5QNK5', {
              'anonymize_ip': true,
              'cookie_flags': 'SameSite=None;Secure'
            });
            console.log('[GDPR] Google Analytics loaded with user consent');
          };
        };
        
        // Function to load reCAPTCHA (loads after any consent or when needed for security)
        window.__loadRecaptcha = function() {
          if (window.__recaptchaLoaded) return Promise.resolve();
          
          return new Promise(function(resolve, reject) {
            window.__recaptchaLoaded = true;
            
            var script = document.createElement('script');
            script.async = true;
            script.src = 'https://www.google.com/recaptcha/enterprise.js?render=6Leg5BgsAAAAAEh94kkCnfgS9vV-Na4Arws3yUtd';
            document.head.appendChild(script);
            
            script.onload = function() {
              console.log('[GDPR] reCAPTCHA loaded');
              resolve();
            };
            script.onerror = function() {
              window.__recaptchaLoaded = false;
              reject(new Error('Failed to load reCAPTCHA'));
            };
          });
        };
        
        // Check for existing consent on page load
        (function() {
          try {
            var stored = localStorage.getItem('cookie_consent');
            if (stored) {
              var consent = JSON.parse(stored);
              // Load analytics if user has given analytics or all consent
              if (consent.level === 'analytics' || consent.level === 'all') {
                window.__loadGoogleAnalytics();
              }
              // Load reCAPTCHA for any consent level except rejected
              if (consent.level !== 'rejected') {
                window.__loadRecaptcha();
              }
            }
          } catch (e) {
            console.warn('[GDPR] Error checking consent:', e);
          }
        })();
        
        // Listen for consent events
        window.addEventListener('cookie_consent_granted', function(e) {
          var level = e.detail && e.detail.level;
          if (level === 'analytics' || level === 'all') {
            window.__loadGoogleAnalytics();
          }
          if (level !== 'rejected') {
            window.__loadRecaptcha();
          }
        });
      </script>
      <script>
        (function() {
          try {
            var savedTheme = localStorage.getItem('plantswipe.theme') || 'system';
            var effectiveTheme = savedTheme;
            if (savedTheme === 'system') {
              effectiveTheme = window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
            }
            if (effectiveTheme === 'dark') {
              document.documentElement.classList.add('dark');
            } else {
              document.documentElement.classList.remove('dark');
            }
          } catch (e) {}
        })();
      </script>
      <link rel="icon" type="image/svg+xml" href="/icons/plant-swipe-icon-outline.svg" />
      <link rel="icon" type="image/png" sizes="192x192" href="/icons/icon-192x192.png" />
      <link rel="icon" type="image/png" sizes="512x512" href="/icons/icon-512x512.png" />
      <link rel="apple-touch-icon" href="/icons/icon-192x192.png" />
      <!-- PWA Manifest - Dynamic manifest with screenshots from database -->
      <link rel="manifest" href="/api/manifest.webmanifest" />
      <style>
        :root {
          color: #0f172a;
          background-color: #f0f4ef;
          -webkit-text-size-adjust: 100%;
        }
        body {
          margin: 0;
          min-height: 100vh;
          background: radial-gradient(circle at 20% 20%, rgba(16, 185, 129, 0.2), transparent 55%),
            radial-gradient(circle at 80% 0%, rgba(15, 118, 110, 0.25), transparent 45%),
            linear-gradient(180deg, #f8faf7 0%, #eef2ed 45%, #e3e5df 100%);
          font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif;
          color: #0f172a;
        }
        #root {
          min-height: 100vh;
        }
        
        /* Loading State Styles */
        .loading-container {
            min-height: 100vh;
            width: 100%;
            padding: 2rem;
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: linear-gradient(to bottom, #f5f5f4, #e7e5e4);
        }
        
        html.dark .loading-container {
            background: linear-gradient(to bottom, #252526, #1e1e1e);
        }
        
        html.dark body {
            background: #1e1e1e; /* Fallback for dark mode body */
            color: #f0f4ef;
        }
        
        @keyframes spin {
          from { transform: rotate(0deg); }
          to { transform: rotate(360deg); }
        }
      </style>
      <!-- Preload CSS as usual, but do not preload the font aggressively -->
      <!-- <link rel="preload" as="style" href="/src/index.scss" /> -->
      <!-- Font preload removed - causes "not used within a few seconds" warning -->
      <!-- The Lavonte font will load on-demand when the font-brand class is used -->
      <!-- This is acceptable as the font is only used for the brand name -->
      <!-- Use script to load CSS to avoid render blocking if possible, or standard link -->
      <!-- Vite handles CSS loading via main.tsx import in dev, but for prod we might need this. -->
      <!-- However, since we renamed to scss, we should rely on Vite injecting it. -->
      <!-- We'll leave a noscript fallback or rely on built assets. -->
      <!-- For dev/preview where src is served: -->
      <noscript><link rel="stylesheet" href="/src/index.scss" /></noscript>
      <title>Aphylia</title>

      <!-- Ensure runtime environment variables load before the app initializes -->
      <script src="/env-loader.js" data-base="/" crossorigin="anonymous"></script>
    </head>
    <body>
      <div id="root">
          <div class="loading-container" aria-busy="true">
              <svg style="width: 3rem; height: 3rem; color: #059669; animation: spin 1s linear infinite;" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                  <circle style="opacity: 0.25;" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                  <path style="opacity: 0.75;" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
              </svg>
          </div>
      </div>
      <!-- Fallback content for web archives and users with JavaScript disabled -->
      <noscript>
        <style>
          .loading-container { display: none !important; }
          .noscript-content {
            max-width: 800px;
            margin: 0 auto;
            padding: 40px 20px;
            font-family: system-ui, -apple-system, sans-serif;
            line-height: 1.6;
          }
          .noscript-content h1 { color: #052e16; margin-bottom: 10px; }
          .noscript-content h2 { color: #065f46; margin-top: 30px; }
          .noscript-content a { color: #059669; }
          .noscript-content .logo { font-size: 2em; margin-bottom: 20px; }
          .noscript-content nav { margin: 20px 0; padding: 15px 0; border-bottom: 1px solid #d1d5db; }
          .noscript-content nav a { margin-right: 20px; text-decoration: none; font-weight: 500; }
          .noscript-content .features { display: grid; gap: 15px; margin: 20px 0; }
          .noscript-content .feature { padding: 15px; background: rgba(16, 185, 129, 0.1); border-radius: 8px; }
          .noscript-content .archive-notice { 
            background: #fef3c7; 
            border: 1px solid #f59e0b; 
            padding: 15px; 
            border-radius: 8px; 
            margin: 20px 0;
          }
          .noscript-content footer { margin-top: 40px; padding-top: 20px; border-top: 1px solid #d1d5db; color: #6b7280; font-size: 0.9em; }
        </style>
        <div class="noscript-content">
          <div class="logo">üå±</div>
          <h1>Welcome to Aphylia</h1>
          <p>Your personal plant companion for discovering, managing, and growing beautiful gardens.</p>
          
          <nav>
            <a href="/">Home</a>
            <a href="/search">Search Plants</a>
            <a href="/blog">Blog</a>
            <a href="/about">About</a>
            <a href="/contact">Contact</a>
          </nav>

          <div class="archive-notice">
            <strong>üìö Viewing an archived or non-JavaScript version</strong><br>
            This page requires JavaScript for full functionality. If you're viewing this from a web archive, 
            the content has been preserved but interactive features won't work.
            <br><br>
            <a href="https://aphylia.app">Visit the live site ‚Üí</a>
          </div>

          <h2>Discover Your Perfect Plants</h2>
          <p>Aphylia helps you find and care for plants that match your lifestyle, space, and experience level.</p>

          <div class="features">
            <div class="feature">
              <strong>üîç Plant Discovery</strong><br>
              Browse thousands of plants with detailed care guides, growing tips, and beautiful photos.
            </div>
            <div class="feature">
              <strong>üè° Garden Management</strong><br>
              Track all your plants in one place. Get reminders for watering, fertilizing, and seasonal tasks.
            </div>
            <div class="feature">
              <strong>üì± Works Everywhere</strong><br>
              Use Aphylia on any device - phone, tablet, or computer. Install as an app for quick access.
            </div>
            <div class="feature">
              <strong>üåç Community</strong><br>
              Share your gardens, discover what others are growing, and learn from fellow plant enthusiasts.
            </div>
          </div>

          <h2>Popular Plant Categories</h2>
          <ul>
            <li><a href="/search?type=vegetable">Vegetables</a> - Tomatoes, peppers, lettuce, and more</li>
            <li><a href="/search?type=herb">Herbs</a> - Basil, mint, rosemary, thyme</li>
            <li><a href="/search?type=flower">Flowers</a> - Roses, tulips, sunflowers</li>
            <li><a href="/search?type=succulent">Succulents</a> - Easy-care plants for beginners</li>
            <li><a href="/search?type=tree">Trees & Shrubs</a> - Fruit trees, ornamentals</li>
          </ul>

          <h2>Latest from Our Blog</h2>
          <p>Visit our <a href="/blog">blog</a> for gardening tips, seasonal guides, and plant care advice.</p>

          <footer>
            <p>&copy; 2024-2025 Aphylia. Helping you grow your plant knowledge üå±</p>
            <p>
              <a href="/terms">Terms of Service</a> ¬∑ 
              <a href="/about">About Us</a> ¬∑ 
              <a href="/contact">Contact</a>
            </p>
          </footer>
        </div>
      </noscript>
      <script type="module" src="/src/main.tsx"></script>
    </body>
</html>