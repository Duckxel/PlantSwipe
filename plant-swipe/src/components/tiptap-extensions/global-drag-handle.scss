// Global Drag Handle Styles
// Adds Notion-like drag handles to all block nodes using CSS

.ProseMirror {
  // Ensure proper positioning context
  position: relative;

  // Add drag handle to all top-level block elements
  > p,
  > h1,
  > h2,
  > h3,
  > h4,
  > h5,
  > h6,
  > ul,
  > ol,
  > blockquote,
  > pre,
  > hr,
  > .tableWrapper,
  > [data-type="imageUpload"],
  > [data-type="imageGrid"],
  > [data-type="resizableImage"],
  > [data-type="emailButton"],
  > [data-type="emailCard"],
  > [data-type="styledDivider"],
  > [data-type="sensitiveCode"] {
    position: relative;

    // The drag handle pseudo-element
    &::before {
      content: "â ¿";
      position: absolute;
      left: -24px;
      top: 0;
      width: 20px;
      height: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
      color: transparent;
      cursor: grab;
      user-select: none;
      transition: color 0.15s ease;
      z-index: 5;
    }

    &:hover::before {
      color: #9ca3af;
    }

    &:active::before {
      cursor: grabbing;
    }
  }

  // Adjust for headings (different line heights)
  > h1::before { top: 0.2em; }
  > h2::before { top: 0.15em; }
  > h3::before { top: 0.1em; }
  > h4::before,
  > h5::before,
  > h6::before { top: 0.05em; }

  // Adjust for lists (handle at first item level)
  > ul::before,
  > ol::before {
    top: 0.1em;
  }

  // Adjust for blockquote
  > blockquote::before {
    left: -28px;
  }

  // Adjust for code blocks
  > pre::before {
    top: 0.5em;
  }

  // Adjust for horizontal rule
  > hr::before {
    top: 50%;
    transform: translateY(-50%);
  }

  // Custom nodes with their own drag handles don't need this
  > [data-type="collapsible"]::before {
    display: none;
  }

  // Selected node highlight
  > .ProseMirror-selectednode {
    outline: 2px solid #10b981;
    outline-offset: 2px;
    border-radius: 4px;

    &::before {
      color: #10b981 !important;
    }
  }

  // Hide on very narrow screens
  @media (max-width: 480px) {
    > p::before,
    > h1::before,
    > h2::before,
    > h3::before,
    > h4::before,
    > h5::before,
    > h6::before,
    > ul::before,
    > ol::before,
    > blockquote::before,
    > pre::before,
    > hr::before,
    > [data-type]::before {
      display: none;
    }
  }
}

// Dark mode
.dark .ProseMirror {
  > p:hover::before,
  > h1:hover::before,
  > h2:hover::before,
  > h3:hover::before,
  > h4:hover::before,
  > h5:hover::before,
  > h6:hover::before,
  > ul:hover::before,
  > ol:hover::before,
  > blockquote:hover::before,
  > pre:hover::before,
  > hr:hover::before,
  > [data-type]:hover::before {
    color: #6b7280;
  }

  > .ProseMirror-selectednode::before {
    color: #34d399 !important;
  }
}

// Ensure editor has enough left padding for drag handles
.simple-editor-content .tiptap.ProseMirror.simple-editor {
  padding-left: 3.5rem;
}

@media screen and (max-width: 480px) {
  .simple-editor-content .tiptap.ProseMirror.simple-editor {
    padding-left: 1.5rem;
  }
}
